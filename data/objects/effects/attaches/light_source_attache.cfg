{
id: "light_source_attache",
prototype: ["effects_attache"],
	zorder: "@include data/zorder.cfg:shadow_overlay",

/*
	This does NOT create a light bloom or anything (although the sprite being used for this is functionally similar).
	
	This instead provides a mask that gets applied to a black overlay that covers the level when a level's designated as "dark".
	Levels are designated as "dark" by simply having a `shadow_effect_controller` on them, anywhere.
	
	This is just a simple sprite attache, but by having it at a very particular zorder, it gets picked up by a shader that does the special behavior.
*/

types: {
	ImageMaskType: "enum { eased_halo, eased_nohalo, elliptical1, linear_from_25pct, linear_from_50pct, linear_from_75pct, linear  }",
},


properties: {
	_sprite_type: { type: "ImageMaskType", dynamic_initialization: true },

	do_setup: "commands :: [
		initialize_position,
		set(animation, enum_to_string(_sprite_type)),
		if( not find(level.chars, value is obj shadow_effect_controller),
			/*
				if there's no controller, then if these actually display it's going to look really ugly - we'll have these giant white circles.  In that case, we need to just immediately delete ourselves.
			*/
			remove_object(me)
		)
	]",
	
	//honestly we probably don't want to use these in most cases, because we'll probably use just straight add_object/remove_object, but it doesn't hurt to add reasonable defaults
	turn_on: "set(alpha, 255)",
	turn_off: "set(alpha, 0)",


	
},
		
		
			
on_end_anim: "set(animation, animation)",		
			
			
animation: [{
	"@base": true,
	no_remove_alpha_borders: true,
	frames: 1,
	pad: 3,
	scale: 2,
	
	blend: ["one","one"],
	rect: [0,0,255,255],
	duration: -1,

},{
	id: "eased_halo",
	image: "effects/light-blooms/matted-onto-black/eased-halo.png",
},{
	id: "eased_nohalo",
	image: "effects/light-blooms/matted-onto-black/eased-nohalo.png",
},{
	id: "elliptical1",
	image: "effects/light-blooms/matted-onto-black/elliptical1.png",
},{
	id: "linear_from_25pct",
	image: "effects/light-blooms/matted-onto-black/linear-from-25pct.png",
},{
	id: "linear_from_50pct",
	image: "effects/light-blooms/matted-onto-black/linear-from-50pct.png",
},{
	id: "linear_from_75pct",
	image: "effects/light-blooms/matted-onto-black/linear-from-75pct.png",
},{
	id: "linear",
	image: "effects/light-blooms/matted-onto-black/linear.png",
}]
}