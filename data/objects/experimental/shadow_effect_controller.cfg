{
	id: "shadow_effect_controller",
	is_strict: true,
	always_active: true,
	hidden_in_game: true,
	zorder: "@include data/zorder.cfg:shadow_overlay",
	scale: 8,

	editor_info: {
		category: "controllers",
		help: "A configurable shadow effect. This replaces\nthe old level properties dark and dark_color.",
	},

	properties: {
		rain_texture: { type: "texture_object", init: "texture_object :: get_texture('raindrops3.png')", persistent: false },
	},
	
	events: {
		create: "
			//add the shader on creation.
			add(level.frame_buffer_shaders, [{
				label: 'shadow_effect',
				begin_zorder: lib.zorder.get('shadow_overlay'),
				end_zorder: lib.zorder.get('shadow_overlay'),
				shader_info: 'shadow',
			}])
		",
		
		process: "[
			set((object<- (object<- shader.shader).uniform_commands).u_shadow_opacity, 1.0)
			|
			shader <- level.frame_buffer_shaders,
				shader.shader_info = 'shadow',
				shader.begin_zorder = lib.zorder.get('shadow_overlay'),
				shader.end_zorder = lib.zorder.get('shadow_overlay')
		]",
		
		being_removed: "[
			//remove the shader when destroyed.
			set(level.frame_buffer_shaders, filter(level.frame_buffer_shaders, value.label != 'shadow_effect'))
		]",
		
		type_updated: "[
			fire_event('being_removed'),
			fire_event('create'),
		]",
	},
}
